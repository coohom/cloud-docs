<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DSL Programing Guide - MINERVAS Help Document</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="dsl.html" class="active"><strong aria-hidden="true">2.</strong> DSL Programing Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="scene_processor.html"><strong aria-hidden="true">2.1.</strong> Scene Processor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="room.html"><strong aria-hidden="true">2.1.1.</strong> Room</a></li><li class="chapter-item expanded "><a href="level.html"><strong aria-hidden="true">2.1.2.</strong> Level</a></li></ol></li><li class="chapter-item expanded "><a href="entity_processor.html"><strong aria-hidden="true">2.2.</strong> Entity Processor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dsl/camera.html"><strong aria-hidden="true">2.2.1.</strong> Camera</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dsl/perspective_camera.html"><strong aria-hidden="true">2.2.1.1.</strong> PerspectiveCamera</a></li><li class="chapter-item expanded "><a href="dsl/orthographic_camera.html"><strong aria-hidden="true">2.2.1.2.</strong> OrthographicCamera</a></li><li class="chapter-item expanded "><a href="dsl/panoramic_camera.html"><strong aria-hidden="true">2.2.1.3.</strong> PanoramicCamera</a></li></ol></li><li class="chapter-item expanded "><a href="dsl/light.html"><strong aria-hidden="true">2.2.2.</strong> Light</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dsl/point_light.html"><strong aria-hidden="true">2.2.2.1.</strong> PointLight</a></li><li class="chapter-item expanded "><a href="dsl/rectangle_light.html"><strong aria-hidden="true">2.2.2.2.</strong> RectangleLight</a></li><li class="chapter-item expanded "><a href="dsl/sun_light.html"><strong aria-hidden="true">2.2.2.3.</strong> Sunlight</a></li><li class="chapter-item expanded "><a href="dsl/iesspot_light.html"><strong aria-hidden="true">2.2.2.4.</strong> IESspotLight</a></li></ol></li><li class="chapter-item expanded "><a href="dsl/instance.html"><strong aria-hidden="true">2.2.3.</strong> Instance</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dsl/material.html"><strong aria-hidden="true">2.2.3.1.</strong> Material</a></li><li class="chapter-item expanded "><a href="dsl/mesh.html"><strong aria-hidden="true">2.2.3.2.</strong> Model</a></li></ol></li><li class="chapter-item expanded "><a href="dsl/trajectory.html"><strong aria-hidden="true">2.2.4.</strong> Trajectory</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dsl/random_trajectory.html"><strong aria-hidden="true">2.2.4.1.</strong> RandomTrajectory</a></li><li class="chapter-item expanded "><a href="dsl/converage_trajectory.html"><strong aria-hidden="true">2.2.4.2.</strong> CoverageTrajectory</a></li><li class="chapter-item expanded "><a href="dsl/defined_trajectory.html"><strong aria-hidden="true">2.2.4.3.</strong> DefinedTrajectory</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="render_processor.html"><strong aria-hidden="true">2.3.</strong> Render Processor</a></li><li class="chapter-item expanded "><a href="pixel_processor.html"><strong aria-hidden="true">2.4.</strong> Pixel Processor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dsl/pixel_process/output_selection.html"><strong aria-hidden="true">2.4.1.</strong> Output Selection</a></li><li class="chapter-item expanded "><a href="dsl/pixel_process/noise.html"><strong aria-hidden="true">2.4.2.</strong> Noise Simulation</a></li><li class="chapter-item expanded "><a href="dsl/pixel_process/distortion.html"><strong aria-hidden="true">2.4.3.</strong> Distortion Simulation</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">3.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/layout_estimation.html"><strong aria-hidden="true">3.1.</strong> Layout Estimation</a></li><li class="chapter-item expanded "><a href="examples/semantic_segmentation.html"><strong aria-hidden="true">3.2.</strong> Semantic Segmentation</a></li><li class="chapter-item expanded "><a href="examples/depth_estimation.html"><strong aria-hidden="true">3.3.</strong> Depth Estimation</a></li><li class="chapter-item expanded "><a href="examples/trajectory_sampling.html"><strong aria-hidden="true">3.4.</strong> SLAM</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">MINERVAS Help Document</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#dsl-programming-guide" id="dsl-programming-guide">DSL Programming Guide</a></h1>
<p>MINERVAS has a programmable dataset generation pipeline with Domain-Specific Language. As the main interface for users to cutomize the dataset generation for different task, we describe our DSL in this section.</p>
<!-- <span style="color:blue">*Comments:* Many formats in DSL description is not unified. </span> -->
<!-- toc -->
<h2><a class="header" href="#introduction-to-dsl-of-minervas" id="introduction-to-dsl-of-minervas">Introduction to DSL of MINERVAS</a></h2>
<p>The DSL (Domain-Specific Language) of MINERVAS is kind of inernal DSL, it is based on Python programming languages. </p>
<p>Each DSL file submitted to MINERVAS system is a Python file ended with <code>.py</code>. </p>
<p>In the Python file, users need to:</p>
<ul>
<li>Declare one or more classes inheriting from corresponding built-in processor class.</li>
</ul>
<ul>
<li>Implement the cutomized operation in the <code>process()</code> function.</li>
</ul>
<!-- The essence of DSL writing is that the user customizes one or more subclasses in the py file. 
The subclasses:
* Three subclasses of the Processor class inherited from KsSDK
- Borrow the interface provided by the SDK and inherited attributes to implement custom functions in the `process()` function -->
<h2><a class="header" href="#processor-classes" id="processor-classes">Processor classes</a></h2>
<p>There are currently four processor classes in MINERVAS system, which reflect different stages of the dataset generation pipeline.</p>
<!-- <span style="color:blue">TODO: Need updates. </span> -->
<ol>
<li>SceneProcessor, provides custom filtering and modifying 3D scenes in scene-level.</li>
</ol>
<pre><code class="language-python">from ksecs.ECS.processors.scene_processor import SceneProcessor
class sceneDsl(SceneProcessor):
	def process(self, *args, **kwargs):
		pass
</code></pre>
<ol start="2">
<li>EntityProcessor, provides custom modifying of each attributes of objects in entity-level.</li>
</ol>
<pre><code class="language-python">from ksecs.ECS.processors.entity_processor import EntityProcessor
class entityDsl(EntityProcessor):
	def process(self, *args, **kwargs):
		pass
</code></pre>
<ol start="3">
<li>RenderProcessor, provides customization in the rendering process. </li>
</ol>
<pre><code class="language-python">from ksecs.ECS.processors.render_processor import RenderProcessor
class renderDsl(RenderProcessor):
	def process(self, *args, **kwargs):
		pass
</code></pre>
<ol start="4">
<li>PixelProcessor, provides customed post-processing of rendered image results</li>
</ol>
<pre><code class="language-python">from ksecs.ECS.processors.pixel_processor import PixelProcessor
class pixelDsl(PixelProcessor):
	def process(self, *args, **kwargs):
		pass
</code></pre>
<!-- 5. StructureProcessor, edit the output structured data
```python
from ksecs.ECS.processors.structure_processor import StructureProcessor
class structureDsl(StructureProcessor):
	def process(self, *args, **kwargs):
		pass
``` -->
<blockquote>
<p><strong>Tips</strong>: Don't forget to import the corresponding processor class from <code>ksces.ECS.processors</code> before use.</p>
</blockquote>
<!-- ## An attribute - shader -->
<h2><a class="header" href="#attribute-shader" id="attribute-shader">Attribute: shader</a></h2>
<p><code>shader</code> is a common attribute of all <code>Processor</code> classes. It is an instance of class <code>Shader</code>, which provides interface for accessing all 3D data assets and built-in function.</p>
<!-- Concretly, the class `Shader` has two attributes: `world` and `image_handler` which are instances of class `World` and class `ImageHandler`.

<span style="color:blue">*Comments:* `Shader` has any functions? </span> -->
<h3><a class="header" href="#world-class" id="world-class"><code>World</code> class</a></h3>
<!-- The user-defined class inherits the attribute shader, which connects to the underlying data structure of the SDK. -->
<!-- Shader is an instantiated object of class `Shader`, which has attributes world and image_handler -->
<!-- <span style="color:blue">*Comments:* More details (e.g. function list.) may be added for `World`, `Element` and `ImageHandler`.</span> -->
<!-- World is an instantiated object of class World, which is used to store the "database" of the input data of CC world, which is composed of various entities of Elment. -->
<p>The class <code>Shader</code> has an attribute: <code>world</code>.
<code>world</code> object is an instance of class <code>World</code>. The <code>World</code> class is an interface for a whole 3D scene in the database. It contains serveral elements:</p>
<table><thead><tr><th>Attribute</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>instances</td><td>list of <code>Instance</code></td><td>All objects (furniture) in the scene</td></tr>
<tr><td>lights</td><td>list of <code>Light</code></td><td>All lights in the scene</td></tr>
<tr><td>rooms</td><td>list of <code>Room</code></td><td>All rooms in the scene (whole floorplan)</td></tr>
<tr><td>levels</td><td>list of <code>Level</code></td><td>Information for each level floors in the scene</td></tr>
<tr><td>trajectories</td><td>list of <code>Trajectory</code></td><td>All trajectories in the scene</td></tr>
<tr><td>cameras</td><td>list of <code>Camera</code></td><td>All exist cameras in the scene</td></tr>
</tbody></table>
<p>We will introduce each class in the following parts.</p>
<!-- #### Element
Currently supports six elements `Instance`, `Light`, `Room`, `Level`, `Trajectory`, and `Camera`.
Each element corresponds to a class, with its own attributes and methods -->
<table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody>
<tr><td>delete_entity((entity))</td><td>delete entity from the scene.</td></tr>
<tr><td>add_camera({attr_name}={attr_value})</td><td>create a new camera and add it to the scene</td></tr>
<tr><td>tune_brightness__all_lights(ratio)</td><td>adjust the brightness of all lights in the scene(ratio: brightness adjustment multiple)</td></tr>
<tr><td>tune_brightness__sunlight(ratio)</td><td>adjust the multiple of natural light and turn off other light sources. (ratio: brightness adjustment multiple)</td></tr>
<tr><td>replace_material(id, type, category)</td><td>domain randomization for materials. See <a href="./dsl/material.html">Material</a></td></tr>
<tr><td>replace_model(id)</td><td>domain randomization for models. See <a href="./dsl/mesh.html">Model</a></td></tr>
<tr><td>add_trajectory({attr_name}={attr_value})</td><td>create a new trajectory and add to the scene. See <a href="./dsl/trajectory.html">Trajectory</a></td></tr>
<tr><td>pick(**kwargs)</td><td>Save customized attributes as output. See example <a href="./examples/layout_estimation.html">Layout Estimation</a>. This function is encouraged to be called in <code>StructureProcessor</code> for robustness.</td></tr>
</tbody></table>
<!-- |(TBD)|-| -->
<!-- ### `ImageHandler` class

`image_handler` object is an instance of class `ImageHandler`. This class contains severl image-related operations which we will introduce in [Noise Simulation](dsl/pixel_process/noise.md).

| Attribute | Type | Description    |
|---    |---  |---   |
| (TBD) | - | - |

| Function | Description    |
|---    |---   |
| save_files(cid, content, suffix, name) | - |
|(TBD)|-| -->
<h2><a class="header" href="#ecs-d" id="ecs-d">ECS-D</a></h2>
<p>Since our system supports customization to the scene, the user should easily access the scene with a suitable 3D scene representation. Thus, we employ the Entity Component System (ECS) architecture to represent and organize the 3D scene in our system. Additionally, to facilitate the randomness of scene synthesis, we integrate random distributions into the original ECS architecture, ie, attaching a distribution to depict each component. The newly proposed architecture is named as ECS-D, where D denotes distributions on components.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="introduction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="scene_processor.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="introduction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="scene_processor.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
